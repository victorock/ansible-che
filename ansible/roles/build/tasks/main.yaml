---
- name: "Ensure epel-release"
  yum:
    name: "epel-release"
    state: "latest"

- name: "Ensure packages"
  yum:
    name: "{{ required_packages }}"
    state: "latest"

- name: "Ensure pip tools"
  pip:
    name:
        - "pip"
        - "setuptools"
        - "pip-tools"
    state: "latest"

- name: "Pip compile requirements.in"
  environment:
    PYCURL_SSL_LIBRARY: openssl
  command: "pip-compile --output-file requirements.txt requirements.in "
  args:
    chdir: "{{ role_path }}/files"
    creates: "requirements.txt"
  
- name: "Ensure requirements"
  environment:
    PYCURL_SSL_LIBRARY: openssl
  pip:
    requirements: "requirements.txt"
    chdir: "{{ role_path }}/files"
    state: "present"

- name: "Copy entrypoint"
  copy:
    src: "files/entrypoint"
    dest: "/entrypoint"
    mode: u=rwx,g=rx,o=rx

- name: "Ensure home directory with root permissions"
  file:
    name: "/home/ansible"
    state: directory
    group: root
    mode: g=u

- name: "Set group bits equal to user bits for /etc/passwd"
  file:
    name: /etc/passwd
    mode: g=u